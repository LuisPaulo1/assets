<?xml version="1.0"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
 <!-- Background -->
 <!-- Title -->
 <!-- Client Section -->
 <!-- Client icon -->
 <!-- PostService -->
 <!-- PostService Components -->
 <!-- H2 Database -->
 <!-- RabbitMQ Central -->
 <!-- Exchange -->
 <!-- Queue 1 -->
 <!-- Queue 2 -->
 <!-- DLQ -->
 <!-- TextProcessorService -->
 <!-- TextProcessor Components -->
 <!-- Flow Arrows and Labels -->
 <!-- Client to PostService -->
 <!-- PostService to Database -->
 <!-- PostService to RabbitMQ Queue 1 -->
 <!-- RabbitMQ Queue 1 to TextProcessor -->
 <!-- TextProcessor to RabbitMQ Queue 2 -->
 <!-- RabbitMQ Queue 2 to PostService -->
 <!-- Exchange Bindings -->
 <!-- Routing Keys Labels -->
 <!-- Message Flow Legend -->
 <!-- Step 1 -->
 <!-- Step 2 -->
 <!-- Step 3 -->
 <!-- Step 4 -->
 <!-- Step 5 -->
 <!-- Step 6 -->
 <!-- Arrow marker definition -->
 <defs>
  <marker id="arrowhead" markerHeight="7" markerWidth="10" orient="auto" refX="9" refY="3.5">
   <polygon fill="#333" id="svg_1" points="0 0, 10 3.5, 0 7"/>
  </marker>
 </defs>
 <g class="layer">
  <title>Layer 1</title>
  <rect fill="#f8f9fa" height="800" id="svg_2" stroke="#dee2e6" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="1200" x="0" y="2"/>
  <text fill="#2c3e50" font-family="Arial, sans-serif" font-size="24" font-weight="bold" id="svg_3" text-anchor="middle" x="600" y="30">AlgaPosts - Arquitetura de Microsserviços</text>
  <rect fill="#e3f2fd" height="400" id="svg_4" rx="5" stroke="#1976d2" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="120" x="50" y="80"/>
  <text fill="#1976d2" font-family="Arial, sans-serif" font-size="14" font-weight="bold" id="svg_5" text-anchor="middle" x="110" y="105">Client</text>
  <circle cx="110" cy="280" fill="#1976d2" id="svg_6" r="25"/>
  <text fill="white" font-family="Arial, sans-serif" font-size="12" id="svg_7" text-anchor="middle" x="110" y="285">👤</text>
  <text fill="#1976d2" font-family="Arial, sans-serif" font-size="12" id="svg_8" text-anchor="middle" x="110" y="320">REST API</text>
  <rect fill="#c8e6c9" height="320" id="svg_9" rx="5" stroke="#388e3c" stroke-width="2" width="180" x="220" y="120"/>
  <text fill="#2e7d32" font-family="Arial, sans-serif" font-size="16" font-weight="bold" id="svg_10" text-anchor="middle" x="310" y="145">PostService</text>
  <text fill="#2e7d32" font-family="Arial, sans-serif" font-size="12" id="svg_11" text-anchor="middle" x="310" y="165">(Port: 8080)</text>
  <rect fill="#fff" height="40" id="svg_12" rx="3" stroke="#388e3c" width="150" x="235" y="180"/>
  <text fill="#2e7d32" font-family="Arial, sans-serif" font-size="12" id="svg_13" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="310" y="199">📋 REST Controllers</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_14" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="310" y="214">POST/GET /api/posts</text>
  <rect fill="#fff" height="40" id="svg_15" rx="3" stroke="#388e3c" width="150" x="235" y="240"/>
  <text fill="#2e7d32" font-family="Arial, sans-serif" font-size="12" id="svg_16" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="310" y="258">🔧 PostService</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_17" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="310" y="273">Business Logic</text>
  <rect fill="#fff" height="40" id="svg_18" rx="3" stroke="#388e3c" width="150" x="235" y="300"/>
  <text fill="#2e7d32" font-family="Arial, sans-serif" font-size="12" id="svg_19" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="310" y="318">📦 RabbitMQ Publisher</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_20" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="310" y="333">Send Messages</text>
  <rect fill="#fff" height="40" id="svg_21" rx="3" stroke="#388e3c" width="150" x="235" y="360"/>
  <text fill="#2e7d32" font-family="Arial, sans-serif" font-size="12" id="svg_22" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="309" y="377">📨 Message Consumer</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_23" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="309" y="392">Receive Results</text>
  <rect fill="#fff3e0" height="60" id="svg_24" rx="5" stroke="#f57c00" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="150" x="235" y="477"/>
  <text fill="#e65100" font-family="Arial, sans-serif" font-size="14" font-weight="bold" id="svg_25" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="311" y="502">💾 H2 Database</text>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="10" id="svg_26" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="311" y="522">Posts Storage</text>
  <rect fill="#fff8e1" height="400" id="svg_27" rx="8" stroke="#ff8f00" stroke-width="3" transform="matrix(1 0 0 1 0 0)" width="283" x="480" y="202"/>
  <text fill="#e65100" font-family="Arial, sans-serif" font-size="18" font-weight="bold" id="svg_28" text-anchor="middle" x="619" y="225">🐰 RabbitMQ Broker</text>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="12" id="svg_29" text-anchor="middle" x="619" y="245">Message Queue System</text>
  <rect fill="#ffcc02" height="50" id="svg_30" rx="5" stroke="#ff8f00" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="245" x="500" y="270"/>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="14" font-weight="bold" id="svg_31" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="620" y="290">📮 Exchange</text>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="11" id="svg_32" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="620" y="308">post-processing-exchange.v1.e</text>
  <rect fill="#fff" height="50" id="svg_33" rx="5" stroke="#ff8f00" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="220" x="507" y="358"/>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_34" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="616" y="378">📥 Text Processor Queue</text>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="9" id="svg_35" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="616" y="398">text-processor-service.post-processing.v1.q</text>
  <rect fill="#fff" height="50" id="svg_36" rx="5" stroke="#ff8f00" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="220" x="510" y="432"/>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_37" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="620" y="452">📤 Post Result Queue</text>
  <text fill="#bf360c" font-family="Arial, sans-serif" font-size="9" id="svg_38" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="620" y="470">post-service.post-processing-result.v1.q</text>
  <rect fill="#ffcdd2" height="50" id="svg_39" rx="5" stroke="#d32f2f" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="220" x="510" y="501"/>
  <text fill="#c62828" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_40" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="621" y="521">⚠️ Dead Letter Queue</text>
  <text fill="#c62828" font-family="Arial, sans-serif" font-size="9" id="svg_41" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="620" y="539">text-processor-service.post-processing.v1.dlq</text>
  <rect fill="#e1bee7" height="320" id="svg_42" rx="5" stroke="#7b1fa2" stroke-width="2" transform="matrix(1 0 0 1 0 0)" width="180" x="866" y="228"/>
  <text fill="#4a148c" font-family="Arial, sans-serif" font-size="16" font-weight="bold" id="svg_43" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="956" y="253">TextProcessorService</text>
  <text fill="#4a148c" font-family="Arial, sans-serif" font-size="12" id="svg_44" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="956" y="272">(Port: 8081)</text>
  <rect fill="#fff" height="40" id="svg_45" rx="3" stroke="#7b1fa2" transform="matrix(1 0 0 1 0 0)" width="150" x="881" y="287"/>
  <text fill="#4a148c" font-family="Arial, sans-serif" font-size="12" id="svg_46" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="956" y="305">📨 Message Consumer</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_47" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="957" y="320">Process Messages</text>
  <rect fill="#fff" height="40" id="svg_48" rx="3" stroke="#7b1fa2" transform="matrix(1 0 0 1 0 0)" width="150" x="882" y="344"/>
  <text fill="#4a148c" font-family="Arial, sans-serif" font-size="12" id="svg_49" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="957" y="363">🔢 Word Counter</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_50" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="957" y="377">Count Words</text>
  <rect fill="#fff" height="40" id="svg_51" rx="3" stroke="#7b1fa2" transform="matrix(1 0 0 1 0 0)" width="150" x="882" y="404"/>
  <text fill="#4a148c" font-family="Arial, sans-serif" font-size="12" id="svg_52" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="957" y="421">💰 Price Calculator</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_53" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="957" y="436">R$ 0.10 per word</text>
  <rect fill="#fff" height="40" id="svg_54" rx="3" stroke="#7b1fa2" transform="matrix(1 0 0 1 0 0)" width="150" x="882" y="464"/>
  <text fill="#4a148c" font-family="Arial, sans-serif" font-size="12" id="svg_55" text-anchor="middle" transform="matrix(1 0 0 1 0 0)" x="955" y="482">📤 Result Publisher</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_56" text-anchor="middle" x="955" y="497">Send Results</text>
  <line id="svg_57" marker-end="url(#arrowhead)" stroke="#1976d2" stroke-width="3" transform="matrix(1 0 0 1 0 0)" x1="170" x2="218" y1="280" y2="280"/>
  <text fill="#1976d2" font-family="Arial, sans-serif" font-size="8" id="svg_58" text-anchor="middle" x="195" y="257">HTTP REST</text>
  <line id="svg_59" marker-end="url(#arrowhead)" stroke="#388e3c" stroke-width="2" transform="matrix(1 0 0 1 0 0)" x1="310" x2="310" y1="440" y2="475"/>
  <path d="m400,320q39.5,0 79,55" fill="none" id="svg_60" marker-end="url(#arrowhead)" stroke="#ff6600" stroke-width="3" transform="matrix(1 0 0 1 0 0)"/>
  <line id="svg_62" marker-end="url(#arrowhead)" stroke="#7b1fa2" stroke-width="3" transform="matrix(1 0 0 1 0 0)" x1="764" x2="864" y1="374" y2="313"/>
  <line id="svg_64" marker-end="url(#arrowhead)" points="null" stroke="#7b1fa2" stroke-width="3" transform="matrix(1.05224 0.152418 -0.22424 0.942861 64.7489 -107.934)" x1="863.42" x2="768.12" y1="483.26" y2="476.79"/>
  <path d="m480,460q-34.67,0 -78,-55" fill="none" id="svg_66" marker-end="url(#arrowhead)" stroke="#ff6600" stroke-width="3"/>
  <rect fill="#f5f5f5" height="180" id="svg_72" rx="5" stroke="#ccc" width="1100" x="50" y="580"/>
  <text fill="#333" font-family="Arial, sans-serif" font-size="16" font-weight="bold" id="svg_73" text-anchor="middle" x="600" y="605">Fluxo de Mensagens</text>
  <circle cx="192" cy="651" fill="#1976d2" id="svg_74" r="15"/>
  <text fill="white" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_75" text-anchor="middle" x="192" y="656">1</text>
  <text fill="#333" font-family="Arial, sans-serif" font-size="12" id="svg_76" x="222" y="646">Cliente envia POST /api/posts</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_77" x="222" y="661">{title, body, author}</text>
  <circle cx="491" cy="652" fill="#388e3c" id="svg_78" r="15"/>
  <text fill="white" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_79" text-anchor="middle" x="491" y="657">2</text>
  <text fill="#333" font-family="Arial, sans-serif" font-size="12" id="svg_80" x="522" y="647">PostService salva no H2</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_81" x="522" y="662">Gera UUID para o post</text>
  <circle cx="792" cy="651" fill="#ff8f00" id="svg_82" r="15"/>
  <text fill="white" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_83" text-anchor="middle" x="792" y="656">3</text>
  <text fill="#333" font-family="Arial, sans-serif" font-size="12" id="svg_84" x="822" y="645">Publica na fila de processamento</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_85" x="822" y="660">{postId, postBody} → Queue</text>
  <circle cx="192" cy="712" fill="#7b1fa2" id="svg_86" r="15"/>
  <text fill="white" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_87" text-anchor="middle" x="192" y="717">4</text>
  <text fill="#333" font-family="Arial, sans-serif" font-size="12" id="svg_88" x="222" y="706">TextProcessor consome mensagem</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_89" x="222" y="721">Conta palavras e calcula valor</text>
  <circle cx="492" cy="712" fill="#ff8f00" id="svg_90" r="15"/>
  <text fill="white" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_91" text-anchor="middle" x="492" y="717">5</text>
  <text fill="#333" font-family="Arial, sans-serif" font-size="12" id="svg_92" x="522" y="707">Publica resultado na fila</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_93" x="522" y="722">{postId, wordCount, calculatedValue}</text>
  <circle cx="792" cy="711" fill="#388e3c" id="svg_94" r="15"/>
  <text fill="white" font-family="Arial, sans-serif" font-size="12" font-weight="bold" id="svg_95" text-anchor="middle" x="792" y="716">6</text>
  <text fill="#333" font-family="Arial, sans-serif" font-size="12" id="svg_96" x="822" y="705">PostService atualiza registro</text>
  <text fill="#666" font-family="Arial, sans-serif" font-size="10" id="svg_97" x="822" y="720">Persiste wordCount e calculatedValue</text>
  <path d="m735.56,320.81q23.99,46.35 -4.66,109.12" fill="none" id="svg_100" marker-end="url(#arrowhead)" stroke="#ff6600" stroke-width="3"/>
  <line id="svg_101" marker-end="url(#arrowhead)" stroke="#388e3c" stroke-width="2" transform="matrix(1 0 0 1 0 0)" x1="622.8" x2="622.8" y1="320.7" y2="355.7"/>
 </g>
</svg>